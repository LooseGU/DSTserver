local _1SZr = require "widgets/followtext" local _Tfc3 = {Asset( "ATLAS" , "images/dyc_white.xml" ), Asset( "IMAGE" , "images/dyc_white.tex" ), Asset( "ATLAS" , "images/dyc_shb_icon.xml" ), Asset( "IMAGE" , "images/dyc_shb_icon.tex" ), Asset( "ATLAS" , "images/dyc_button_close.xml" ), Asset( "IMAGE" , "images/dyc_button_close.tex" ), Asset( "ATLAS" , "images/dycghb_claw.xml" ), Asset( "IMAGE" , "images/dycghb_claw.tex" ), Asset( "ATLAS" , "images/dycghb_shadow.xml" ), Asset( "IMAGE" , "images/dycghb_shadow.tex" ), Asset( "ATLAS" , "images/dycghb_shadow_i.xml" ), Asset( "IMAGE" , "images/dycghb_shadow_i.tex" ), Asset( "ATLAS" , "images/dycghb_round.xml" ), Asset( "IMAGE" , "images/dycghb_round.tex" ), Asset( "ATLAS" , "images/dycghb_panel.xml" ), Asset( "IMAGE" , "images/dycghb_panel.tex" ), Asset( "ATLAS" , "images/dycghb_pixel.xml" ), Asset( "IMAGE" , "images/dycghb_pixel.tex" ), Asset( "ATLAS" , "images/dycghb_pixel_i.xml" ), Asset( "IMAGE" , "images/dycghb_pixel_i.tex" ), Asset( "ATLAS" , "images/dycghb_buckhorn.xml" ), Asset( "IMAGE" , "images/dycghb_buckhorn.tex" ), Asset( "ATLAS" , "images/dycghb_victorian.xml" ), Asset( "IMAGE" , "images/dycghb_victorian.tex" ), Asset( "ATLAS" , "images/dycghb_victorian_i.xml" ), Asset( "IMAGE" , "images/dycghb_victorian_i.tex" ), } local _CRJ0 = {} local _1CXu = SimpleHealthBar.Color local _YUt3 = SimpleHealthBar.lib.TableRemoveValue local _oDN4 = SimpleHealthBar.lib.TableContains local function _mR2a() return TheSim:GetGameID() == "DST" end local function _txxT() return _mR2a() and not TheWorld.ismastersim end local function _uA8I() return PLATFORM == "WIN32_STEAM" or PLATFORM == "OSX_STEAM" or PLATFORM == "LINUX_STEAM" end local function _e2jc() if _mR2a() then return ThePlayer else return GetPlayer() end end local function _QhzF(_czGw) local _JMqA = _e2jc() if _JMqA == _czGw then return true end if not _JMqA or not _JMqA:IsValid() or not _czGw:IsValid() then return false end local _ktay = _JMqA:GetPosition():Dist(_czGw:GetPosition()) return _ktay <= TUNING.DYC_HEALTHBAR_MAXDIST end local function _e5eb(_mcKf) if TheSim.GetCameraPos ~= nil then local _uZFA = Vector3(TheSim:GetCameraPos()) return _uZFA:Dist(_mcKf:GetPosition()) else local _Epq5 = TheCamera.pitch * DEGREES local _Lrng = TheCamera.heading * DEGREES local _ei2X = math.cos(_Epq5) local _lFBQ = math.cos(_Lrng) local _g6Jb = math.sin(_Lrng) local _zKDj = - _ei2X * _lFBQ local _YhZO = - math.sin(_Epq5) local _Htkn = - _ei2X * _g6Jb local _3f2t, zoffs = 0x0, 0x0 if TheCamera.currentscreenxoffset ~= 0x0 then local _wuZ2 = 0x2 * TheCamera.currentscreenxoffset / RESOLUTION_Y local _f4u6 = 1.03 local _cq0Q = math.tan(TheCamera.fov * .5 * DEGREES) * TheCamera.distance * _f4u6 _3f2t = - _wuZ2 * _g6Jb * _cq0Q zoffs = _wuZ2 * _lFBQ * _cq0Q end local _L49x = Vector3(TheCamera.currentpos.x - _zKDj * TheCamera.distance + _3f2t, TheCamera.currentpos.y - _YhZO * TheCamera.distance, TheCamera.currentpos.z - _Htkn * TheCamera.distance + zoffs) return _L49x:Dist(_mcKf:GetPosition()) end end local _pDb3 = SimpleHealthBar.ds( "kti!" ) local _WghD = SimpleHealthBar.ds( "~qk|wzqiv" ) local _CJJU = SimpleHealthBar.ds( "xq\"mt" ) local _7P3f = SimpleHealthBar.ds( "j}kspwzv" ) local _NhuV = SimpleHealthBar.ds( "{pilw!" ) local _hQ5E = "images/dyc_white.xml" local _qGhH = "dyc_white.tex" local _ricN = - 0x2d local _uW7z = 0x3c local _e8Hp = {["heart"] = {c1 = "♡" , c2 = "♥" , }, ["circle"] = {c1 = "○" , c2 = "●" , }, ["square"] = {c1 = "□" , c2 = "■" , }, ["diamond"] = {c1 = "◇" , c2 = "◆" , }, ["star"] = {c1 = "☆" , c2 = "★" , }, ["square2"] = {c1 = "░" , c2 = "▓" , }, ["basic"] = {c1 = "=" , c2 = "#" , numCoeff = 1.6, }, ["hidden"] = {c1 = " " , c2 = " " , }, ["chinese"] = {c1 = "口" , c2 = "回" , }, ["standard"] = {c1 = " " , c2 = " " , graphic = {basic = {atlas = "images/dyc_white.xml" , texture = "dyc_white.tex" , }, }, }, ["simple"] = {c1 = " " , c2 = " " , graphic = {bg = {atlas = "images/ui.xml" , texture = "bg_plain.tex" , color = _1CXu.New(0.3, 0.3, 0.3)}, bar = {atlas = "images/ui.xml" , texture = "bg_plain.tex" , margin = {x1 = 0x0, x2 = 0x0, y1 = 0x0, y2 = 0x0, }, }, basic = {atlas = "images/dyc_white.xml" , texture = "dyc_white.tex" , }, }, }, [_pDb3] = { c1 = " " , c2 = " " , graphic = {basic = {atlas = "images/dyc_white.xml" , texture = "dyc_white.tex" , }, bgSkn = {mode = "slice13" , atlas = "images/dycghb_".._pDb3..".xml" , texname = "dycghb_".._pDb3, texScale = 0x3e7, margin = {x1 = - 0.75, x2 = - 0.75, y1 = - 0.225, y2 = - 0.225, fixed = false}, }, barSkn = {mode = "slice33" , atlas = "images/dycghb_round.xml" , texname = "dycghb_round" , texScale = 0x1, margin = {x1 = 0.015, x2 = 0.015, y1 = 0.06, y2 = 0.06, fixed = false}, }, }, }, [_WghD] = { c1 = " " , c2 = " " , graphic = {basic = {atlas = "images/dyc_white.xml" , texture = "dyc_white.tex" , }, bgSkn = {mode = "slice13" , atlas = "images/dycghb_".._WghD..".xml" , texname = "dycghb_".._WghD, texScale = 0x3e7, margin = {x1 = - 1.7, x2 = - 1.7, y1 = - 0.45, y2 = - 0.55, fixed = false}, }, barSkn = {mode = "slice33" , atlas = "images/dycghb_".._WghD.."_i.xml" , texname = "dycghb_".._WghD.."_i" , texScale = 0.25, margin = {x1 = 0.03, x2 = 0.03, y1 = 0.15, y2 = 0.15, fixed = false}, }, }, }, [_7P3f] = { c1 = " " , c2 = " " , graphic = {basic = {atlas = "images/dyc_white.xml" , texture = "dyc_white.tex" , }, bgSkn = {mode = "slice13" , atlas = "images/dycghb_".._7P3f..".xml" , texname = "dycghb_".._7P3f, texScale = 0x3e7, margin = {x1 = - 1.2, x2 = - 1.2, y1 = - 0.43, y2 = - 0.48, fixed = false}, }, bar = {atlas = "images/ui.xml" , texture = "bg_plain.tex" , margin = {x1 = 0x0, x2 = 0x0, y1 = 0x0, y2 = 0x0, fixed = false}, }, }, }, [_CJJU] = { c1 = " " , c2 = " " , graphic = {basic = {atlas = "images/dyc_white.xml" , texture = "dyc_white.tex" , }, bgSkn = {mode = "slice13" , atlas = "images/dycghb_".._CJJU..".xml" , texname = "dycghb_".._CJJU, texScale = 0x3e7, margin = {x1 = - 1.1, x2 = - 0.4, y1 = - 0.365, y2 = - 0.285, fixed = false}, }, barSkn = {mode = "slice13" , atlas = "images/dycghb_".._CJJU.."_i.xml" , texname = "dycghb_".._CJJU.."_i" , texScale = 0x3e7, margin = {x1 = - 1.1, x2 = - 0.4, y1 = - 0.365, y2 = - 0.285, fixed = false}, vmargin = {x1 = 0.675, x2 = - 0.075, y1 = 0.1, y2 = 0.13, fixed = false}, }, hrUseBarColor = true, }, }, [_NhuV] = { c1 = " " , c2 = " " , graphic = {basic = {atlas = "images/dyc_white.xml" , texture = "dyc_white.tex" , }, bgSkn = {mode = "slice33" , atlas = "images/dycghb_".._NhuV..".xml" , texname = "dycghb_".._NhuV, texScale = 0.5, margin = {x1 = - 0xb, x2 = - 0xb, y1 = - 0x9, y2 = - 0xb, fixed = true}, }, barSkn = {mode = "slice33" , atlas = "images/dycghb_".._NhuV.."_i.xml" , texname = "dycghb_".._NhuV.."_i" , texScale = 0.3, }, }, }, } local _nvAG = {{prefab = "shadowtentacle" , width = 0.5, height = 0x2, }, {prefab = "mean_flytrap" , width = 0.9, height = 2.3, }, {prefab = "thunderbird" , width = 0.85, height = 2.05, }, {prefab = "glowfly" , width = 0.6, height = 0x2, }, {prefab = "peagawk" , width = 0.85, height = 2.1, }, {prefab = "krampus" , width = 0x1, height = 3.75, }, {prefab = "nightmarebeak" , width = 0x1, height = 4.5, }, {prefab = "terrorbeak" , width = 0x1, height = 4.5, }, {prefab = "spiderqueen" , width = 0x2, height = 4.5, }, {prefab = "warg" , width = 1.7, height = 0x5, }, {prefab = "pumpkin_lantern" , width = 0.7, height = 1.5, }, {prefab = "jellyfish_planted" , width = 0.7, height = 1.5, }, {prefab = "babybeefalo" , width = 0x1, height = 2.2, }, {prefab = "beeguard" , width = 0.65, height = 0x2, }, {prefab = "shadow_rook" , width = 1.8, height = 3.5, }, {prefab = "shadow_bishop" , width = 0.9, height = 3.2, }, {prefab = "walrus" , width = 1.1, height = 3.2, }, {prefab = "teenbird" , width = 1.0, height = 3.6, }, {tag = "player" , width = 0x1, height = 2.65, }, {tag = "ancient_hulk" , width = 1.85, height = 4.5, }, {tag = "antqueen" , width = 2.4, height = 0x8, }, {tag = "ro_bin" , width = 0.9, height = 2.8, }, {tag = "gnat" , width = 0.75, height = 0x3, }, {tag = "spear_trap" , width = 0.75, height = 0x3, }, {tag = "hangingvine" , width = 0.85, height = 0x4, }, {tag = "weevole" , width = 0.6, height = 1.2, }, {tag = "flytrap" , width = 0x1, height = 3.4, }, {tag = "vampirebat" , width = 0x1, height = 0x3, }, {tag = "pangolden" , width = 1.4, height = 3.8, }, {tag = "spider_monkey" , width = 1.6, height = 0x4, }, {tag = "hippopotamoose" , width = 1.35, height = 3.1, }, {tag = "piko" , width = 0.5, height = 0x1, }, {tag = "pog" , width = 0.85, height = 0x2, }, {tag = "ant" , width = 0.8, height = 2.3, }, {tag = "scorpion" , width = 0.85, height = 0x2, }, {tag = "dungbeetle" , width = 0.8, height = 2.3, }, {tag = "civilized" , width = 0x1, height = 3.2, }, {tag = "koalefant" , width = 1.7, height = 0x4, }, {tag = "spat" , width = 1.5, height = 3.5, }, {tag = "lavae" , width = 0.8, height = 1.5, }, {tag = "glommer" , width = 0.9, height = 2.9, }, {tag = "deer" , width = 0x1, height = 3.1, }, {tag = "snake" , width = 0.85, height = 1.7, }, {tag = "eyeturret" , width = 0x1, height = 4.5, }, {tag = "primeape" , width = 0.85, height = 1.5, }, {tag = "monkey" , width = 0.85, height = 1.5, }, {tag = "ox" , width = 1.5, height = 3.75, }, {tag = "beefalo" , width = 1.5, height = 3.75, }, {tag = "kraken" , width = 0x2, height = 5.5, }, {tag = "nightmarecreature" , width = 1.25, height = 3.5, }, {tag = "bishop" , width = 0x1, height = 0x4, }, {tag = "rook" , width = 1.25, height = 0x4, }, {tag = "knight" , width = 0x1, height = 0x3, }, {tag = "bat" , width = 0.8, height = 0x3, }, {tag = "minotaur" , width = 1.75, height = 4.5, }, {tag = "packim" , width = 0.9, height = 3.75, }, {tag = "stungray" , width = 0.9, height = 3.75, }, {tag = "ghost" , width = 0.9, height = 3.75, }, {tag = "tallbird" , width = 1.25, height = 0x5, }, {tag = "chester" , width = 0.85, height = 1.5, }, {tag = "hutch" , width = 0.85, height = 1.5, }, {tag = "wall" , width = 0.5, height = 1.5, }, {tag = "largecreature" , width = 0x2, height = 7.2, }, {tag = "insect" , width = 0.5, height = 1.6, }, {tag = "smallcreature" , width = 0.85, height = 1.5, }, } local function _vJ8w(_xUdE) if _xUdE < 0x0 then _xUdE = 0x0 elseif _xUdE > 0x1 then _xUdE = 0x1 end return _xUdE end local function _JnqJ(_HGNp, _9Kmt) local _G5zk = _e2jc() local _SDbO = _9Kmt or (_HGNp and _G5zk == _HGNp and _G["TUNING"]["DYC_HEALTHBAR_STYLE_CHAR"]) or (_HGNp and _HGNp["dycshb_cstyle_net"] and _HGNp["dycshb_cstyle_net"]:value()) or _G["TUNING"]["DYC_HEALTHBAR_STYLE"] if type(_SDbO) == "table" and _SDbO.c1 and _SDbO.c2 then return _SDbO end return _e8Hp[_SDbO] or _e8Hp["standard"] end SimpleHealthBar.GetHBStyle = _JnqJ local function _KfIV(_pzjQ, _HUjG, _fIdg) local _Gx1H = _e2jc() local _vrpM = _JnqJ(_fIdg) local _ihaz = _vrpM.c1 local _jXO3 = _vrpM.c2 local _Ty3D = TUNING.DYC_HEALTHBAR_CNUM * (_vrpM.numCoeff or 0x1) local _OEti = "" if TUNING.DYC_HEALTHBAR_POSITION == 0x0 then _OEti = "  \n  \n  \n  \n" end local _w7Sp = _pzjQ / _HUjG for _AQn7 = 0x1, _Ty3D do if _w7Sp == 0x0 or (_AQn7 ~= 0x1 and _AQn7 * 1.0 / _Ty3D > _w7Sp) then _OEti = _OEti.._ihaz else _OEti = _OEti.._jXO3 end end return _OEti end local function _2tOu(_MEtt) if not _MEtt then return 0x1 end for _Z6Ni, _yTGT in pairs(_nvAG) do if _yTGT.width and (_MEtt.prefab == _yTGT.prefab or (_yTGT.tag and _MEtt:HasTag(_yTGT.tag))) then return _yTGT.width end end return 0x1 end local function _gqXR(_OJBb) if not _OJBb then return 2.65 end for _dSky, _JalC in pairs(_nvAG) do if _JalC.height and (_OJBb.prefab == _JalC.prefab or (_JalC.tag and _OJBb:HasTag(_JalC.tag))) then return _JalC.height end end return 2.65 end local function _3cH0(_jtro) _jtro = _jtro or {} local _eKOS = _jtro.owner local _1lUN = _jtro.info or TUNING.DYC_HEALTHBAR_COLOR local _A8ij = _jtro.hpp local _3Gss = _e2jc() if type(_1lUN) == "table" and _1lUN.Get then return _1lUN:Get() elseif type(_1lUN) == "table" and _1lUN.r and _1lUN.g and _1lUN.b then return _1lUN.r, _1lUN.g, _1lUN.b, _1lUN.a or 0x1 elseif type(_1lUN) == "string" and (_1lUN == "dynamic_dark" or _1lUN == "dark" ) and _A8ij then local _1Mq3, g = _vJ8w((0x1 - _A8ij) * 0x2), _vJ8w(_A8ij * 0x2) return _1Mq3 * 0.7, g * 0.5, 0x0, 0x1 elseif type(_1lUN) == "string" and (_1lUN == "dynamic_hostility" or _1lUN == "hostility" or _1lUN == "dynamic2" ) then if _eKOS and _eKOS == _3Gss then return 0.15, 0.55, 0.7, 0x1 end if _eKOS and _eKOS.components.combat then local _t5TY = _eKOS.components.combat.defaultdamage if _eKOS.components.combat.target == _3Gss and not _eKOS:HasTag( "chester" ) and _t5TY and type(_t5TY) == "number" and _t5TY > 0x0 then return 0.8, 0x0, 0x0, 0x1 end end if _eKOS and _eKOS.replica and _eKOS.replica.combat and _eKOS.replica.combat.GetTarget then if _eKOS.replica.combat:GetTarget() == _3Gss then return 0.8, 0x0, 0x0, 0x1 end end if _eKOS and _eKOS.components.follower then if _eKOS.components.follower.leader == _3Gss then return 0.1, 0.7, 0.2, 0x1 end end if _eKOS and _eKOS.replica and _eKOS.replica.follower and _eKOS.replica.follower.GetLeader then if _eKOS.replica.follower:GetLeader() == _3Gss then return 0.1, 0.7, 0.2, 0x1 end end if _eKOS and _eKOS:HasTag( "hostile" ) then return 0.8, 0.5, 0.1, 0x1 end if _eKOS and _eKOS:HasTag( "monster" ) then return 0.7, 0.7, 0.1, 0x1 end if _eKOS and (_eKOS:HasTag( "chester" ) or _eKOS:HasTag( "companion" )) then return 0.1, 0.7, 0.2, 0x1 end if _eKOS and _eKOS:HasTag( "player" ) then return 0x75 / 0xff, 0x1b / 0xff, 0xc6 / 0xff, 0x1 end return 0.7, 0.7, 0.7, 0x1 elseif type(_1lUN) == "string" and SimpleHealthBar.Color:GetColor(_1lUN) then return SimpleHealthBar.Color:GetColor(_1lUN) elseif _A8ij then local _Ukov, g = _vJ8w((0x1 - _A8ij) * 0x2), _vJ8w(_A8ij * 0x2) return _Ukov, g, 0x0, 0x1 end return 0x1, 0x1, 0x1, 0x1 end SimpleHealthBar.GetEntHBColor = _3cH0 local function _mQKW(_9IMe) return _9IMe:HasTag( "wall" ) or _9IMe:HasTag( "spear_trap" ) or (_9IMe.prefab and _9IMe.prefab == "shadowtentacle" ) end local function _5Sk2(_8H7L) local _1bJw = nil if not _8H7L.dychbowner then _8H7L.dychbowner = _8H7L.entity:GetParent() if not _8H7L.dychbowner then _8H7L:Remove() return end _8H7L.dychbowner.dychealthbar = _8H7L end _1bJw = _8H7L.dychbowner if _mR2a() or TUNING.DYC_HEALTHBAR_POSITION == 0x0 then _8H7L.dychbtext = _8H7L.dychbowner:SpawnChild( "dyc_healthbarchild" ) else _8H7L.dychbtext = _8H7L:SpawnChild( "dyc_healthbarchild" ) end _8H7L:EnableText(false) _8H7L.dychbtext:EnableText(false) _8H7L.SetHBHeight = function(_Tp9G, _dy5i) if TUNING.DYC_HEALTHBAR_POSITION == 0x0 then _dy5i = 0x0 end if _mR2a() then _Tp9G:SetOffset(0x0, _dy5i, 0x0) _Tp9G.dychbtext:SetOffset(0x0, _dy5i, 0x0) else _Tp9G.dychbheight = _dy5i * 1.5 end end _8H7L.dychbheightconst = _gqXR(_8H7L.dychbowner) _8H7L:SetHBHeight(_8H7L.dychbheightconst) _8H7L.SetHBSize = function(_0Z8Q, _7yAU) local _xwku = math.max(0x1, (0xd - TUNING.DYC_HEALTHBAR_CNUM) / 0x5) * 0xf * _7yAU _0Z8Q:SetFontSize(_xwku) _0Z8Q.dychbtext:SetFontSize(0x14 * _7yAU) local _4owi = _0Z8Q.graphicHealthbar if _4owi then if not TUNING.DYC_HEALTHBAR_FIXEDTHICKNESS then local _Cy4V = TUNING.DYC_HEALTHBAR_THICKNESS or 0x1 _4owi:SetHBSize(0x78 * TUNING.DYC_HEALTHBAR_CNUM / 0xa, 0x12 * _Cy4V) _4owi:SetHBScale(_7yAU) else local _7i7S = TUNING.DYC_HEALTHBAR_THICKNESS or 0x12 _4owi:SetHBSize(0x78 * TUNING.DYC_HEALTHBAR_CNUM / 0xa * _7yAU, _7i7S) end end end _8H7L:SetHBSize(_2tOu(_8H7L.dychbowner)) if _8H7L.graphicHealthbar then local _L1L7 = _8H7L.graphicHealthbar _L1L7:SetTarget(_1bJw) local _ReTL = _JnqJ(_1bJw).graphic if _ReTL then _L1L7:SetData(_ReTL) _L1L7:SetOpacity(TUNING.DYC_HEALTHBAR_OPACITY or _ReTL.opacity or 0.8) _L1L7:SetHBScale() end if _ReTL and not _L1L7.shown then local _NDnf = not TUNING.DYC_HEALTHBAR_WALLHB and _L1L7.target and _mQKW(_L1L7.target) if not _NDnf then _L1L7:Show() end end if TUNING.DYC_HEALTHBAR_ANIMATION then if _1bJw:HasTag( "largecreature" ) then _L1L7:AnimateIn(0x2) else _L1L7:AnimateIn(0x8) end end end _8H7L.dycHbStarted = true end shb[SimpleHealthBar.ds( "wv]xli|mPJ" )] = function() for _UD4J, _hnnF in pairs(SimpleHealthBar.GHB.ghbs) do local _1oCF = _JnqJ(_hnnF.target).graphic local _20dO = TUNING.DYC_HEALTHBAR_WALLHB ~= true and _hnnF.target and _hnnF.target:HasTag( "wall" ) if _1oCF and not _20dO and not _hnnF.shown then _hnnF:Show() elseif(not _1oCF or _20dO) and _hnnF.shown then _hnnF:Hide() end if _1oCF then _hnnF:SetData(_1oCF) _hnnF:SetOpacity(TUNING.DYC_HEALTHBAR_OPACITY or _1oCF.opacity or 0.8) _hnnF:SetHBScale() end end end local function _DjlS(_2qff) local _WCct = CreateEntity() _WCct.entity:AddTransform() _WCct:AddTag( "FX" ) local _MJRA = not _2qff local _bry9 = _WCct.entity:AddLabel() _bry9:SetFont(NUMBERFONT) _bry9:SetFontSize(0x1c) _bry9:SetColour(0x1, 0x1, 0x1) _bry9:SetText( " " ) _bry9:Enable(true) _WCct.text = _bry9 _WCct.SetFontSize = function(_DuOU, _5B0w) _DuOU.text:SetFontSize(_5B0w) end _WCct.SetOffset = function(_zgf0, _aehD, _sEmE, _xZXO) _zgf0.text:SetWorldOffset(_aehD, _sEmE, _xZXO) end _WCct.SetText = function(_k42s, _GbDK) _k42s.text:SetText(_GbDK) end _WCct.EnableText = function(_Celj, _EBWA) _Celj.text:Enable(_EBWA) end local _zSPP = _WCct.Remove _WCct.persists = false _WCct.InitHB = _5Sk2 return _WCct end local function _xmsI(_BoiG) if not _e2jc() or not _e2jc().HUD then return end local _e3LN = _JnqJ().graphic local _HaJb = _e2jc().HUD.overlayroot:AddChild(SimpleHealthBar.GHB(_e3LN or {basic = {atlas = _hQ5E, texture = _qGhH, }})) _HaJb:MoveToBack() _HaJb:Hide() _HaJb:SetFontSize(0x20) _HaJb:SetYOffSet(_ricN, true) _HaJb:SetTextColor(0x1, 0x1, 0x1, 0x1) _HaJb:SetOpacity(TUNING.DYC_HEALTHBAR_OPACITY or _e3LN.opacity or 0.8) _HaJb:SetStyle( "textoverbar" ) _HaJb.preUpdateFn = function(_JI0x) if _JnqJ(_HaJb.target).graphic and _JI0x > 0x0 and _HaJb.target and TUNING.DYC_HEALTHBAR_POSITION == 0x1 then local _NEy6 = 0x1e / _e5eb(_HaJb.target) _HaJb:SetYOffSet(_BoiG.dychbheightconst * _uW7z * _NEy6) _HaJb:SetStyle( "textoverbar" ) if _HaJb.fontSize ~= 0x20 then _HaJb:SetFontSize(0x20) end elseif _JnqJ(_HaJb.target).graphic and _JI0x > 0x0 and _HaJb.target and TUNING.DYC_HEALTHBAR_POSITION == 0x2 then local _3881 = 0x1e / _e5eb(_HaJb.target) _HaJb:SetYOffSet(_BoiG.dychbheightconst * _uW7z * _3881) _HaJb:SetStyle( "" ) if _HaJb.fontSize ~= 0x18 then _HaJb:SetFontSize(0x18) end elseif _JnqJ(_HaJb.target).graphic and _JI0x > 0x0 and _HaJb.target and TUNING.DYC_HEALTHBAR_POSITION == 0x0 then _HaJb:SetYOffSet(_ricN, true) _HaJb:SetStyle( "textoverbar" ) if _HaJb.fontSize ~= 0x20 then _HaJb:SetFontSize(0x20) end end end _BoiG.graphicHealthbar = _HaJb end local function _SWfP(_jhr8) table.insert(SimpleHealthBar.hbs, _jhr8) if TUNING.DYC_HEALTHBAR_LIMIT > 0x0 and #SimpleHealthBar.hbs > TUNING.DYC_HEALTHBAR_LIMIT then local _Lu0s = SimpleHealthBar.hbs[0x1] table.remove(SimpleHealthBar.hbs, 0x1) end end local function _36GI() local _CHLE = _DjlS() if _mR2a() then _CHLE.entity:AddNetwork() end _CHLE:SetFontSize(0xf) if _mR2a() then _CHLE.dychpini = - 0x1 _CHLE.dychp = 0x0 _CHLE.dychp_net = net_float(_CHLE.GUID, "dyc_healthbar.hp" , "dychpdirty" ) _CHLE:ListenForEvent( "dychpdirty" , function(_1V10) local _2sc2 = _1V10.dychp_net:value() if _1V10.dychpini == - 0x1 then _1V10.dychpini = _2sc2 if not TUNING.DYC_HEALTHBAR_DDON then _1V10.dychpini = - 0x2 end end if TUNING.DYC_HEALTHBAR_DDON then if _1V10.dychbowner and _QhzF(_1V10.dychbowner) then local _XwOD = SpawnPrefab( "dyc_damagedisplay" ) if _1V10.dychpini > 0x0 then _XwOD:DamageDisplay(_1V10.dychbowner, {hpOld = _1V10.dychpini, hpNewDefault = _2sc2}) _1V10.dychpini = - 0x2 else _XwOD:DamageDisplay(_1V10.dychbowner, {hpNewDefault = _2sc2}) end end end _1V10.dychp = _2sc2 end) _CHLE.dychpmax = 0x0 _CHLE.dychpmax_net = net_float(_CHLE.GUID, "dyc_healthbar.hpmax" , "dychpmaxdirty" ) _CHLE:ListenForEvent( "dychpmaxdirty" , function(_pqYs) _pqYs.dychpmax = _pqYs.dychpmax_net:value() end) end local _Y6Ez = - 0x1 local _TKzp = - 0x1 local _RHER = 0x0 local _8ZDw = true local _wE96 = false _CHLE.dycHbStarted = false _CHLE.OnRemoveEntity = function(_4oX1) if _mR2a() and _4oX1.dychbowner and TUNING.DYC_HEALTHBAR_DDON and _QhzF(_4oX1.dychbowner) then local _fylo = SpawnPrefab( "dyc_damagedisplay" ) _fylo:DamageDisplay(_4oX1.dychbowner, {hpNewDefault = _4oX1.dychp}) end _4oX1.Label:SetText( " " ) if _4oX1.dychbowner then _4oX1.dychbowner.dychealthbar = nil end if _4oX1.dychbtext then _4oX1.dychbtext:Remove() end if _4oX1.dychbtask then _4oX1.dychbtask:Cancel() end if _4oX1.graphicHealthbar then if TUNING.DYC_HEALTHBAR_ANIMATION then _4oX1.graphicHealthbar:AnimateOut(0x6) else _4oX1.graphicHealthbar:Kill() end end _YUt3(SimpleHealthBar.hbs, _4oX1) end function _CHLE:DYCHBSetTimer(_QxdM) _RHER = _QxdM _wE96 = true end _xmsI(_CHLE) _SWfP(_CHLE) _CHLE.dychbtask = _CHLE:DoPeriodicTask(FRAMES, function() if not _CHLE.dycHbStarted then return end local _hoUG = _CHLE.dychbowner if not _hoUG then return end local _dmVr = _CHLE.dychbattacker local _vMju = nil if not _txxT() then _vMju = _hoUG.components.health else _vMju = _hoUG.replica.health end if not _hoUG:IsValid() or _hoUG.inlimbo or _hoUG:HasTag( "playerghost" ) or (not _mR2a() and not _QhzF(_hoUG)) or (_txxT() and not _hoUG:HasTag( "player" )) or _vMju == nil or _vMju:IsDead() or _RHER >= TUNING.DYC_HEALTHBAR_DURATION then if not _txxT() then _CHLE:Remove() return end end if _hoUG.dychealthbar ~= _CHLE then _CHLE:Remove() return end if not _hoUG:IsValid() then return end local _Yv48 = 0x0 local _2rgV = 0x0 if not _mR2a() then _Yv48 = _vMju.currenthealth _2rgV = _vMju.maxhealth else _Yv48 = _CHLE.dychp _2rgV = _CHLE.dychpmax end if _vMju ~= nil and (TUNING.DYC_HEALTHBAR_FORCEUPDATE == true or _Y6Ez ~= _Yv48 or _TKzp ~= _2rgV or _wE96) then _wE96 = false _Y6Ez = _Yv48 _TKzp = _2rgV local _r2xK = not TUNING.DYC_HEALTHBAR_WALLHB and _hoUG and _hoUG:HasTag( "wall" ) if _r2xK then _CHLE:EnableText(false) _CHLE.dychbtext:EnableText(false) else _CHLE:EnableText(true) _CHLE.dychbtext:EnableText(true) end _CHLE:SetText(_KfIV(_Y6Ez, _TKzp, _hoUG)) if TUNING.DYC_HEALTHBAR_VALUE and not _JnqJ(_hoUG).graphic then if TUNING.DYC_HEALTHBAR_POSITION ~= 0x0 then _CHLE.dychbtext:SetText(string.format( " %d/%d\n   " , _Y6Ez, _TKzp)) else _CHLE.dychbtext:SetText(string.format( "  \n  \n %d/%d\n   " , _Y6Ez, _TKzp)) end else _CHLE.dychbtext:SetText( "" ) end if _CHLE.SetHBHeight and _CHLE.dychbheightconst then _CHLE:SetHBHeight(_CHLE.dychbheightconst) end local _jMuu = _Y6Ez / _TKzp _CHLE.text:SetColour(_3cH0({owner = _hoUG, hpp = _jMuu, })) if _CHLE.graphicHealthbar then local _zkIt = _CHLE.graphicHealthbar local _E1JU = _JnqJ(_hoUG).graphic if _E1JU then _zkIt.showValue = TUNING.DYC_HEALTHBAR_VALUE _zkIt:SetValue(_Y6Ez, _TKzp, _8ZDw) _zkIt:SetBarColor(_3cH0({owner = _hoUG, hpp = _jMuu, })) end end _8ZDw = false end local _f7tk = true local _TRKs = nil if not _txxT() then _TRKs = _hoUG.components.combat else _TRKs = _hoUG.replica.combat end if _TRKs and _TRKs.target then _f7tk = false else if _dmVr and _dmVr:IsValid() then local _fCdT = nil local _Enwz = nil if not _txxT() then _fCdT = _dmVr.components.health _Enwz = _dmVr.components.combat else _fCdT = _dmVr.replica.health _Enwz = _dmVr.replica.combat end if _fCdT and not _fCdT:IsDead() and _Enwz and _Enwz.target == _hoUG then _f7tk = false end end end if _f7tk then _RHER = _RHER + FRAMES else _RHER = 0x0 end if _mR2a() or TUNING.DYC_HEALTHBAR_POSITION == 0x0 then else local _qsvp = _hoUG:GetPosition() _qsvp.y = _CHLE.dychbheight or 0x0 _CHLE.Transform:SetPosition(_qsvp:Get()) end end) if _txxT() then _CHLE:DoTaskInTime(0x0, function() _CHLE:InitHB() end) end return _CHLE end local function _0jxA(_1A2l, _dZZ6, _Wj25) if not _1A2l:IsValid() or not _dZZ6:IsValid() or _dZZ6.dycddcd == true then _1A2l:Remove() return end _dZZ6.dycddcd = true local _76bJ = nil if not _txxT() then _76bJ = _dZZ6.components.health else _76bJ = _dZZ6.replica.health end _1A2l.Transform:SetPosition((_dZZ6:GetPosition() + Vector3(0x0, _gqXR(_dZZ6) * 0.65, 0x0)):Get()) local _rfEQ = (_Wj25 and _Wj25.hpOld) or (not _mR2a() and _dZZ6.components.health.currenthealth) or (_dZZ6.dychealthbar and _dZZ6.dychealthbar.dychp) or (_76bJ and _76bJ:IsDead() and 0x0) or (_Wj25 and _Wj25.hpOldDefault) or 0x0 local _JK0m = false local _Yjdm = math.random() * 0x168 local _Ft35 = TUNING.DYC_HEALTHBAR_DDDURATION / 0x2 local _J3ss = 0x1 local _Zzoq = 0x2 local _Mg7u = 0x2 * _Zzoq / _Ft35 / _Ft35 local _uABu = 0x0 local _qW7U = _J3ss / _Ft35 local _OR1q = math.sqrt(0x2 * _Mg7u * _Zzoq) local _JQw3 = _Ft35 * 0x2 local _WNAC = false local _q6ve = TUNING.DYC_HEALTHBAR_DDDELAY local _NST2 = 0x0 _1A2l.dycddtask = _1A2l:DoPeriodicTask(FRAMES, function() if not _1A2l:IsValid() or not _dZZ6:IsValid() then _1A2l.dycddtask:Cancel() _1A2l:Remove() return end _NST2 = _NST2 + FRAMES _uABu = _NST2 - _q6ve if _NST2 > _q6ve then if _JK0m == false then _dZZ6.dycddcd = false local _1odC = (_Wj25 and _Wj25.hpNew) or (not _mR2a() and _dZZ6.components.health.currenthealth) or (_dZZ6.dychealthbar and _dZZ6.dychealthbar.dychp) or (_76bJ and _76bJ:IsDead() and 0x0) or (_Wj25 and _Wj25.hpNewDefault) or 0x0 local _NF1x = _1odC - _rfEQ local _SS6T = math.abs(_NF1x) if _SS6T < TUNING.DYC_HEALTHBAR_DDTHRESHOLD then _1A2l.dycddtask:Cancel() _1A2l:Remove() return else _JK0m = true _1A2l.Label:Enable(true) local _vjq2 = "" if _NF1x > 0x0 then _1A2l.Label:SetColour(0x0, 0x1, 0x0) _vjq2 = "+" else _1A2l.Label:SetColour(0x1, 0x0, 0x0) _WNAC = true end if _SS6T < 0x1 then _1A2l.Label:SetText(_vjq2..string.format( "%.2f" , _NF1x)) elseif _SS6T < 0x64 then _1A2l.Label:SetText(_vjq2..string.format( "%.1f" , _NF1x)) else _1A2l.Label:SetText(_vjq2..string.format( "%d" , _NF1x)) end end end local _ccTi = _1A2l:GetPosition() local _cuE9 = Vector3(_qW7U * FRAMES * math.cos(_Yjdm), _OR1q * FRAMES, _qW7U * FRAMES * math.sin(_Yjdm)) _1A2l.Transform:SetPosition(_ccTi.x + _cuE9.x, _ccTi.y + _cuE9.y, _ccTi.z + _cuE9.z) _OR1q = _OR1q - _Mg7u * FRAMES local _QFey = (0x1 - math.abs(_uABu / _Ft35 - 0x1)) * (TUNING.DYC_HEALTHBAR_DDSIZE2 - TUNING.DYC_HEALTHBAR_DDSIZE1) + TUNING.DYC_HEALTHBAR_DDSIZE1 _1A2l.Label:SetFontSize(_QFey) if _WNAC then local _exQH = 0x1 - _vJ8w(_uABu / _Ft35 - 0.5) _1A2l.Label:SetColour(0x1, _exQH, _exQH) end if _uABu >= _JQw3 then _1A2l.dycddtask:Cancel() _1A2l:Remove() end end end) end local function _cf3A() local _NyNd = _DjlS(true) _NyNd.Label:SetFontSize(TUNING.DYC_HEALTHBAR_DDSIZE1) _NyNd.Label:Enable(false) _NyNd.InitHB = nil _NyNd.DamageDisplay = _0jxA return _NyNd end return Prefab( "common/dyc_damagedisplay" , _cf3A, _Tfc3, _CRJ0), Prefab( "common/dyc_healthbarchild" , _DjlS, _Tfc3, _CRJ0), Prefab( "common/dyc_healthbar" , _36GI, _Tfc3, _CRJ0) 