local function _CCVH() return GLOBAL.TheSim:GetGameID() == "DST" end local function _1R5b() return _CCVH() and GLOBAL.TheNet:GetIsClient() end local function _x6n2() return _CCVH() and GLOBAL.TheNet:IsDedicated() end local function _sGFI() if _CCVH() then return GLOBAL.ThePlayer else return GLOBAL.GetPlayer() end end local function _U8yg() if _CCVH() then return GLOBAL.TheWorld else return GLOBAL.GetWorld() end end local function _hUNz(_U0Kt) local _Y9Gd = nil for _q5Fd, _PMOQ in pairs(GLOBAL.AllPlayers) do if _PMOQ.userid == _U0Kt then _Y9Gd = _PMOQ end end return _Y9Gd end PrefabFiles = { "dychealthbar" , } Assets = {} STRINGS = GLOBAL.STRINGS RECIPETABS = GLOBAL.RECIPETABS Recipe = GLOBAL.Recipe Ingredient = GLOBAL.Ingredient TECH = GLOBAL.TECH TUNING = GLOBAL.TUNING FRAMES = GLOBAL.FRAMES SpawnPrefab = GLOBAL.SpawnPrefab Vector3 = GLOBAL.Vector3 tostring = GLOBAL.tostring tonumber = GLOBAL.tonumber require = GLOBAL.require TheSim = GLOBAL.TheSim net_string = GLOBAL.net_string net_float = GLOBAL.net_float local _IrgS = function(_JIa6, _lPZS, _aQjR, _ZvWa) return {r = _JIa6 or 0x1, g = _lPZS or 0x1, b = _aQjR or 0x1, a = _ZvWa or 0x1, Get = function(_gLnx) return _gLnx.r, _gLnx.g, _gLnx.b, _gLnx.a end, Set = function(_AkLx, _bC3h, _uRH0, _N40m, _ZOii) _AkLx.r = _bC3h or 0x1; _AkLx.g = _uRH0 or 0x1; _AkLx.b = _N40m or 0x1; _AkLx.a = _ZOii or 0x1; end, } end local _kXcK = {New = _IrgS, Red = _IrgS(0x1, 0x0, 0x0, 0x1), Green = _IrgS(0x0, 0x1, 0x0, 0x1), Blue = _IrgS(0x0, 0x0, 0x1, 0x1), White = _IrgS(0x1, 0x1, 0x1, 0x1), Black = _IrgS(0x0, 0x0, 0x0, 0x1), Yellow = _IrgS(0x1, 0x1, 0x0, 0x1), Magenta = _IrgS(0x1, 0x0, 0x1, 0x1), Cyan = _IrgS(0x0, 0x1, 0x1, 0x1), Gray = _IrgS(0.5, 0.5, 0.5, 0x1), Orange = _IrgS(0x1, 0.5, 0x0, 0x1), Purple = _IrgS(0.5, 0x0, 0x1, 0x1), GetColor = function(_VXot, _0NJ6) if _0NJ6 == nil then return end for _eTsz, _6N4T in pairs(_VXot) do if type(_6N4T) == "table" and _6N4T.r then if string.lower(_eTsz) == string.lower(_0NJ6) then return _6N4T end end end end, } local function _VRys(_jte5, _FKlB) if _CCVH() then GLOBAL.TheNet:Say(_jte5, _FKlB) else print( "It's DS!" ) end end local function _DemM() if not _U8yg() then return end TUNING.DYC_HEALTHBAR_FORCEUPDATE = true _U8yg():DoTaskInTime(GLOBAL.FRAMES * 0x4, function() TUNING.DYC_HEALTHBAR_FORCEUPDATE = false end) end GLOBAL.SHB = {} GLOBAL.shb = GLOBAL.SHB GLOBAL.SimpleHealthBar = GLOBAL.SHB local _hbLn = GLOBAL.SHB local _nKrQ = GLOBAL.SHB _hbLn.version = modinfo.version _hbLn.Color = _kXcK _hbLn.ShowBanner = function() end _hbLn.PushBanner = function() end _hbLn.SetColor = function(_hKW3, _LBpl, _UzxD) if _hKW3 and type(_hKW3) == "string" then if _hKW3 == "cfg" then _hbLn.SetColor(TUNING.DYC_HEALTHBAR_COLOR_CFG) return end local _yTAC = string.lower(_hKW3) for _TsYp, _ChD9 in pairs(_kXcK) do if string.lower(_TsYp) == _yTAC and type(_ChD9) == "table" then TUNING.DYC_HEALTHBAR_COLOR = _ChD9 _DemM() return end end elseif _hKW3 and _LBpl and _UzxD and type(_hKW3) == "number" and type(_LBpl) == "number" and type(_UzxD) == "number" then TUNING.DYC_HEALTHBAR_COLOR = _kXcK.New(_hKW3, _LBpl, _UzxD) _DemM() return end TUNING.DYC_HEALTHBAR_COLOR = _hKW3 _DemM() end _hbLn.setcolor = _hbLn.SetColor _hbLn.SETCOLOR = _hbLn.SetColor _hbLn.SetLength = function(_HPr5) _HPr5 = _HPr5 or 0xa if type(_HPr5) ~= "number" then if _HPr5 == "cfg" then _HPr5 = TUNING.DYC_HEALTHBAR_CNUM_CFG else _HPr5 = 0xa end end _HPr5 = math.floor(_HPr5) if _HPr5 < 0x1 then _HPr5 = 0x1 end if _HPr5 > 0x64 then _HPr5 = 0x64 end TUNING.DYC_HEALTHBAR_CNUM = _HPr5 _DemM() end _hbLn.setlength = _hbLn.SetLength _hbLn.SETLENGTH = _hbLn.SetLength _hbLn.SetDuration = function(_cQFl) _cQFl = _cQFl or 0x8 if type(_cQFl) ~= "number" then _cQFl = 0x8 end if _cQFl < 0x4 then _cQFl = 0x4 end if _cQFl > 0xf423f then _cQFl = 0xf423f end TUNING.DYC_HEALTHBAR_DURATION = _cQFl end _hbLn.setduration = _hbLn.SetDuration _hbLn.SETDURATION = _hbLn.SetDuration _hbLn.SetStyle = function(_ARlI, _Hkte, _v9Rd, _RTnx) local _KjE5 = nil if _ARlI and _Hkte and type(_ARlI) == "string" and type(_Hkte) == "string" then TUNING.DYC_HEALTHBAR_STYLE = {c1 = _ARlI, c2 = _Hkte} elseif _ARlI == "cfg" then TUNING.DYC_HEALTHBAR_STYLE = TUNING.DYC_HEALTHBAR_STYLE_CFG _KjE5 = TUNING.DYC_HEALTHBAR_STYLE if _RTnx then _RTnx(_KjE5) end else if _v9Rd == "c" then TUNING.DYC_HEALTHBAR_STYLE_CHAR = _ARlI and string.lower(_ARlI) or nil _KjE5 = TUNING.DYC_HEALTHBAR_STYLE_CHAR or TUNING.DYC_HEALTHBAR_STYLE else TUNING.DYC_HEALTHBAR_STYLE = _ARlI and string.lower(_ARlI) or "standard" _KjE5 = TUNING.DYC_HEALTHBAR_STYLE end local _Wcoa = _ARlI and _hbLn.lib.TableContains(_hbLn[_hbLn.ds( "{xmkqitPJ{" )], _ARlI) if _Wcoa then _hbLn.GetUData(_ARlI, function(_gWw6) if not _gWw6 then _hbLn.SetStyle( "standard" , nil, _v9Rd) if _RTnx then _RTnx( "standard" ) end else if _RTnx then _RTnx(_KjE5) end end end) else if _RTnx then _RTnx(_KjE5) end end end _DemM() if _hbLn.onUpdateHB then _hbLn.onUpdateHB(_ARlI, _Hkte) end return _KjE5 end _hbLn.setstyle = _hbLn.SetStyle _hbLn.SETSTYLE = _hbLn.SetStyle local function _jtjd(_4ldQ, _I14I, _8T3D) if _4ldQ == "global" then return _hbLn.SetStyle(nil, nil, "c" , _8T3D) else return _hbLn.SetStyle(_4ldQ, _I14I, "c" , _8T3D) end end _hbLn.SetPos = function(_zzsY) if _zzsY and string.lower(_zzsY) == "bottom" then TUNING.DYC_HEALTHBAR_POSITION = 0x0 elseif _zzsY and string.lower(_zzsY) == "overhead2" then TUNING.DYC_HEALTHBAR_POSITION = 0x2 elseif _zzsY == "cfg" then TUNING.DYC_HEALTHBAR_POSITION = TUNING.DYC_HEALTHBAR_POSITION_CFG else TUNING.DYC_HEALTHBAR_POSITION = 0x1 end _DemM() end _hbLn.setpos = _hbLn.SetPos _hbLn.SETPOS = _hbLn.SetPos _hbLn.SetPosition = _hbLn.SetPos _hbLn.setposition = _hbLn.SetPos _hbLn.SETPOSITION = _hbLn.SetPos _hbLn.ValueOn = function() TUNING.DYC_HEALTHBAR_VALUE = true _DemM() end _hbLn.valueon = _hbLn.ValueOn _hbLn.VALUEON = _hbLn.ValueOn _hbLn.ValueOff = function() TUNING.DYC_HEALTHBAR_VALUE = false _DemM() end _hbLn.valueoff = _hbLn.ValueOff _hbLn.VALUEOFF = _hbLn.ValueOff _hbLn.DDOn = function() TUNING.DYC_HEALTHBAR_DDON = true end _hbLn.ddon = _hbLn.DDOn _hbLn.DDON = _hbLn.DDOn _hbLn.DDOff = function() TUNING.DYC_HEALTHBAR_DDON = false end _hbLn.ddoff = _hbLn.DDOff _hbLn.DDOFF = _hbLn.DDOff _hbLn.SetLimit = function(_B3v3) _B3v3 = _B3v3 or 0x0 _B3v3 = math.floor(_B3v3) TUNING.DYC_HEALTHBAR_LIMIT = _B3v3 if TUNING.DYC_HEALTHBAR_LIMIT > 0x0 then while #_hbLn.hbs > TUNING.DYC_HEALTHBAR_LIMIT do local _mJzx = _hbLn.hbs[0x1] table.remove(_hbLn.hbs, 0x1) end end end _hbLn.setlimit = _hbLn.SetLimit _hbLn.SETLIMIT = _hbLn.SetLimit _hbLn.SetOpacity = function(_DkCV) _DkCV = _DkCV or 0x1 _DkCV = math.max(0.1, math.min(_DkCV, 0x1)) TUNING.DYC_HEALTHBAR_OPACITY = _DkCV if _hbLn.onUpdateHB then _hbLn.onUpdateHB(str, str2) end end _hbLn.setopacity = _hbLn.SetOpacity _hbLn.SETOPACITY = _hbLn.SetOpacity _hbLn.ToggleAnimation = function(_Yx4c) TUNING.DYC_HEALTHBAR_ANIMATION = _Yx4c and true or false end _hbLn.toggleanimation = _hbLn.ToggleAnimation _hbLn.TOGGLEANIMATION = _hbLn.ToggleAnimation _hbLn.ToggleWallHB = function(_ZOjF) TUNING.DYC_HEALTHBAR_WALLHB = _ZOjF and true or false end _hbLn.togglewallhb = _hbLn.ToggleWallHB _hbLn.TOGGLEWALLHB = _hbLn.ToggleWallHB _hbLn.SetThickness = function(_PHZS) _PHZS = _PHZS ~= nil and type(_PHZS) == "number" and _PHZS or 1.0 TUNING.DYC_HEALTHBAR_THICKNESS = _PHZS if _PHZS > 0x2 then TUNING.DYC_HEALTHBAR_FIXEDTHICKNESS = true else TUNING.DYC_HEALTHBAR_FIXEDTHICKNESS = false end end _hbLn.setthickness = _hbLn.SetThickness _hbLn.SETTHICKNESS = _hbLn.SetThickness _hbLn.DYC = {} _hbLn.dyc = _hbLn.DYC _hbLn.D = _hbLn.DYC _hbLn.d = _hbLn.DYC _hbLn.DYC.S = function(_o66c, _iVKQ) _iVKQ = _iVKQ or 0x1 _VRys( "-shb d s ".._o66c.." ".._iVKQ, true) end _hbLn.DYC.s = _hbLn.DYC.S _hbLn.DYC.G = function(_DIEq, _8q1u) _8q1u = _8q1u or 0x1 _VRys( "-shb d g ".._DIEq.." ".._8q1u, true) end _hbLn.DYC.g = _hbLn.DYC.G _hbLn.DYC.A = function(_VPnx) _VRys( "-shb d a ".._VPnx, true) end _hbLn.DYC.a = _hbLn.DYC.A _hbLn.DYC.SPD = function(_zjUL) _VRys( "-shb d spd ".._zjUL, true) end _hbLn.DYC.spd = _hbLn.DYC.SPD TUNING.DYC_HEALTHBAR_STYLE = GetModConfigData( "hbstyle" ) or "standard" TUNING.DYC_HEALTHBAR_STYLE_CFG = TUNING.DYC_HEALTHBAR_STYLE TUNING.DYC_HEALTHBAR_CNUM = GetModConfigData( "hblength" ) or 0xa TUNING.DYC_HEALTHBAR_CNUM_CFG = TUNING.DYC_HEALTHBAR_CNUM TUNING.DYC_HEALTHBAR_DURATION = 0x8 TUNING.DYC_HEALTHBAR_POSITION = GetModConfigData( "hbpos" ) or "overhead" TUNING.DYC_HEALTHBAR_POSITION_CFG = TUNING.DYC_HEALTHBAR_POSITION TUNING.DYC_HEALTHBAR_VALUE = GetModConfigData( "value" ) or (GetModConfigData( "value" ) == nil and true) TUNING.DYC_HEALTHBAR_VALUE_CFG = TUNING.DYC_HEALTHBAR_VALUE local _Y1NV = GetModConfigData( "hbcolor" ) TUNING.DYC_HEALTHBAR_COLOR_CFG = _Y1NV _hbLn.SetColor(_Y1NV) TUNING.DYC_HEALTHBAR_DDON = GetModConfigData( "ddon" ) or (GetModConfigData( "ddon" ) == nil and true) TUNING.DYC_HEALTHBAR_DDON_CFG = TUNING.DYC_HEALTHBAR_DDON TUNING.DYC_HEALTHBAR_DDDURATION = 0.65 TUNING.DYC_HEALTHBAR_DDSIZE1 = 0x14 TUNING.DYC_HEALTHBAR_DDSIZE2 = 0x32 TUNING.DYC_HEALTHBAR_DDTHRESHOLD = 0.7 TUNING.DYC_HEALTHBAR_DDDELAY = 0.05 TUNING.DYC_HEALTHBAR_MAXDIST = 0x23 TUNING.DYC_HEALTHBAR_LIMIT = 0x0 TUNING.DYC_HEALTHBAR_WALLHB = true _hbLn.hbs = {} local _qWi4 = function(_eMOq, _NxoS, _KVrq, _2OdJ) _NxoS = _NxoS or 0x8 local _XYUa, MI = _2OdJ and 0xff or 0x7e, _2OdJ and 0x0 or 0x21 local _tBtf = "" local _lunr = function(_hZAR, _zKlw, _LKRy) if _LKRy or (_hZAR ~= 0x9 and _hZAR ~= 0xa and _hZAR ~= 0xd and _hZAR ~= 0x20) then _hZAR = _hZAR + _zKlw while _hZAR > _XYUa do _hZAR = _hZAR - (_XYUa - MI + 0x1) end while _hZAR < MI do _hZAR = _hZAR + (_XYUa - MI + 0x1) end end return _hZAR end for _AEXO = 0x1, #_eMOq do local _1ESk = string.byte(string.sub(_eMOq, _AEXO, _AEXO)) if _KVrq and _KVrq > 0x1 and _AEXO % _KVrq == 0x0 then _1ESk = _lunr(_1ESk, _NxoS, _2OdJ) else _1ESk = _lunr(_1ESk, - _NxoS, _2OdJ) end _tBtf = _tBtf..string.char(_1ESk) end return _tBtf end _hbLn.ds = _qWi4 local _Xe7C = function(_chKM) local _sJes = GLOBAL[_qWi4( "qw" )][_qWi4( "wxmv" )] local _j7LV, err = _sJes(_chKM, "r" ) if err then else local _vK0s = _j7LV:read( "*all" ) _j7LV:close() return _vK0s end return "" end local _CR8m = function(_gvKZ) local _NPnR = "../mods/"..modname.."/" local _MdEd = GLOBAL[_qWi4( "stmqtwilt}i" )](_NPnR.._gvKZ) if _MdEd ~= nil and type(_MdEd) == "function" then return _MdEd elseif _MdEd ~= nil and type(_MdEd) == "string" then local _17Os = _qWi4(_Xe7C(_NPnR.._gvKZ), 0xb, 0x3) return GLOBAL.loadstring(_17Os) else return nil end end local function _9Jdb(_GzoD, _3csq) local _NARg = _CR8m(_GzoD) if _NARg then if _3csq then setfenv(_NARg, _3csq) end return _NARg(), _GzoD.." is loaded." else return nil, "Error loading ".._GzoD.."!" end end _hbLn.lf = _9Jdb _hbLn[_qWi4( "tqj" )] = _9Jdb(_qWi4( "{kzqx|{7l#kuq{k6t}i" )) _hbLn[_qWi4( "twkitq$i|qwv" )] = _9Jdb(_qWi4( "twkitq$i|qwv6t}i" )) _hbLn[_qWi4( "OPJ" )] = _9Jdb(_qWi4( "{kzqx|{7l#kopj6t}i" )) _hbLn[_qWi4( "twkitLi|i" )] = _hbLn["lib"][_qWi4( "TwkitLi|i" )]() _hbLn[_qWi4( "twkitLi|i" )]:SetName( "SimpleHealthBar" ) _hbLn[_qWi4( "o}q{" )] = _9Jdb(_qWi4( "{kzqx|{7l#ko}q{6t}i" )) local _gVvQ = _hbLn.lib.StrSpl local _HV8N = nil local _vwQg = _qWi4( "IllUwlZXKPivltmz" ) local _DH4x = _qWi4( "[mvlUwlZXK\\w[mz~mz" ) local _5It3 = _qWi4( "Om|UwlZXK" ) if _CCVH() then local function _N6QR(_hg5L, _w7el) _hg5L.dycshb_cstyle_net:set(_w7el) end env[_vwQg](modname, "SetPStyle" , _N6QR) local function _vy7g(_M8Un) env[_DH4x](env[_5It3](modname, "SetPStyle" ), _M8Un) end _HV8N = _vy7g end local function _KAQj() local _Si9v = _hbLn["localData"] local _h5uf = _hbLn.menu _Si9v:GetString( "gstyle" , function(_gYCj) _h5uf.gStyleSpinner:SetSelected(_gYCj, "standard" ) end) _Si9v:GetString( "cstyle" , function(_fNJA) _h5uf.cStyleSpinner:SetSelected(_fNJA, "global" ) end) _Si9v:GetString( "value" , function(_Zxqy) _h5uf.valueSpinner:SetSelected(_Zxqy, "true" ) end) _Si9v:GetString( "length" , function(_sEUf) if _sEUf == "cfg" then _h5uf.lengthSpinner:SetSelected(_sEUf, 0xa) else _h5uf.lengthSpinner:SetSelected(_sEUf ~= nil and tonumber(_sEUf), 0xa) end end) _Si9v:GetString( "thickness" , function(_KYU7) _h5uf.thicknessSpinner:SetSelected(_KYU7 ~= nil and tonumber(_KYU7), 0x16) end) _Si9v:GetString( "pos" , function(_Yftm) _h5uf.posSpinner:SetSelected(_Yftm, "overhead2" ) end) _Si9v:GetString( "color" , function(_pG98) _h5uf.colorSpinner:SetSelected(_pG98, "dynamic2" ) end) _Si9v:GetString( "opacity" , function(_gKEB) _h5uf.opacitySpinner:SetSelected(_gKEB ~= nil and tonumber(_gKEB), 0.8) end) _Si9v:GetString( "dd" , function(_M8fH) _h5uf.ddSpinner:SetSelected(_M8fH, "true" ) end) _Si9v:GetString( "anim" , function(_5Xa9) _h5uf.animSpinner:SetSelected(_5Xa9, "true" ) end) _Si9v:GetString( "wallhb" , function(_ztxn) _h5uf.wallhbSpinner:SetSelected(_ztxn, "false" ) end) _Si9v:GetString( "hotkey" , function(_kr1o) _h5uf.hotkeySpinner:SetSelected(_kr1o, "KEY_H" ) end) _Si9v:GetString( "icon" , function(_x4Ut) _h5uf.iconSpinner:SetSelected(_x4Ut, "true" ) end) end local function _kxra(_Ep4I) local _OKtp = _hbLn["localData"] _OKtp:SetString( "gstyle" , _Ep4I.gstyle) _OKtp:SetString( "cstyle" , _Ep4I.cstyle) _OKtp:SetString( "value" , _Ep4I.value) _OKtp:SetString( "length" , tostring(_Ep4I.length)) _OKtp:SetString( "thickness" , tostring(_Ep4I.thickness)) _OKtp:SetString( "pos" , _Ep4I.pos) _OKtp:SetString( "color" , _Ep4I.color) _OKtp:SetString( "opacity" , tostring(_Ep4I.opacity)) _OKtp:SetString( "dd" , _Ep4I.dd) _OKtp:SetString( "anim" , _Ep4I.anim) _OKtp:SetString( "wallhb" , _Ep4I.wallhb) _OKtp:SetString( "hotkey" , _Ep4I.hotkey) _OKtp:SetString( "icon" , _Ep4I.icon) end local function _2YWt() local _znjX = _hbLn.menu _znjX.gStyleSpinner:SetSelected( "standard" ) _znjX.cStyleSpinner:SetSelected( "global" ) _znjX.valueSpinner:SetSelected( "true" ) _znjX.lengthSpinner:SetSelected(0xa) _znjX.thicknessSpinner:SetSelected(0x16) _znjX.posSpinner:SetSelected( "overhead2" ) _znjX.colorSpinner:SetSelected( "dynamic2" ) _znjX.opacitySpinner:SetSelected(0.8) _znjX.ddSpinner:SetSelected( "true" ) _znjX.animSpinner:SetSelected( "true" ) _znjX.wallhbSpinner:SetSelected( "false" ) _znjX.hotkeySpinner:SetSelected( "KEY_H" ) _znjX.iconSpinner:SetSelected( "true" ) _znjX:DoApply() end _hbLn.Reset = _2YWt _hbLn.reset = _2YWt _hbLn.RESET = _2YWt local function _XVIE(_Rgc7) _Rgc7.initGhbTask = _Rgc7:DoPeriodicTask(FRAMES, function() local _OVKm = _sGFI() if not _OVKm then return end if _Rgc7.dycPlayerHud == _OVKm.HUD then return else _Rgc7.dycPlayerHud = _OVKm.HUD end SpawnPrefab( "dyc_damagedisplay" ):Remove() local _Zkqo = _OVKm[_qWi4( "}{mzql" )] _hbLn["uid"] = _Zkqo local _RecQ = _hbLn["localData"] local _3CvY = _hbLn.localization:GetStrings() local _9iuv = _hbLn.guis.Root local _FHYk = _OVKm.HUD.root:AddChild(_9iuv({keepTop = true, })) _OVKm.HUD.dycSHBRoot = _FHYk _hbLn["ShowMessage"] = function(_V7Gy, _ZWsx, _n632, _9hzS, _HHMu, _kD4v, _ATEJ, _WQCh, _6AA2) _hbLn.guis["MessageBox"]["ShowMessage"](_V7Gy, _ZWsx, _FHYk, _3CvY, _n632, _9hzS, _HHMu, _kD4v, _ATEJ, _WQCh, _6AA2) end local _N2z4 = _hbLn.guis.CfgMenu local _VPC6 = _FHYk:AddChild(_N2z4({strings = _3CvY, GHB = _hbLn.GHB, GetHBStyle = _hbLn.GetHBStyle, GetEntHBColor = _hbLn.GetEntHBColor, ["ShowMessage"] = _hbLn["ShowMessage"]})) _hbLn.menu = _VPC6 _VPC6:Hide() _KAQj() _VPC6.applyFn = function(_ICY1, _SLX8) _hbLn.SetStyle(_SLX8.gstyle) if _CCVH() then _jtjd(_SLX8.cstyle, nil, function(_5Eas) _HV8N(_5Eas) end) else _jtjd(_SLX8.cstyle) end if _SLX8.value == "cfg" then if TUNING.DYC_HEALTHBAR_VALUE_CFG then _hbLn.ValueOn() else _hbLn.ValueOff() end elseif _SLX8.value == "true" then _hbLn.ValueOn() else _hbLn.ValueOff() end _hbLn.SetLength(_SLX8.length) _hbLn.SetThickness(_SLX8.thickness) _hbLn.SetPos(_SLX8.pos) _hbLn.SetColor(_SLX8.color) _hbLn.SetOpacity(_SLX8.opacity) if _SLX8.dd == "cfg" then if TUNING.DYC_HEALTHBAR_DDON_CFG then _hbLn.DDOn() else _hbLn.DDOff() end else if _SLX8.dd == "true" then _hbLn.DDOn() else _hbLn.DDOff() end end if _SLX8.anim == "false" then _hbLn.ToggleAnimation(false) else _hbLn.ToggleAnimation(true) end if _SLX8.wallhb == "false" then _hbLn.ToggleWallHB(false) else _hbLn.ToggleWallHB(true) end if _SLX8.icon == "false" then if _hbLn.menuSwitch then _hbLn.menuSwitch:Hide() end else if _hbLn.menuSwitch then _hbLn.menuSwitch:Show() end end if _SLX8.icon == "false" and _SLX8.hotkey == "" then _hbLn.PushBanner(_3CvY:GetString( "hint_mistake" ), 0x19, {0x1, 0x1, 0.7}) elseif _SLX8.icon == "false" and _SLX8.hotkey ~= "" then _hbLn.PushBanner(string.format(_3CvY:GetString( "hint_hotkeyreminder" ), _SLX8.hotkey), 0x8, {0x1, 0x1, 0.7}) end _kxra(_SLX8) end _VPC6.cancelFn = function(_cl8f) _KAQj() end local _sTLH = _hbLn.guis.ImageButton local _EW6J = _FHYk:AddChild(_sTLH({width = 0x3c, height = 0x3c, draggable = true, followScreenScale = true, atlas = "images/dyc_shb_icon.xml" , normal = "dyc_shb_icon.tex" , focus = "dyc_shb_icon.tex" , disabled = "dyc_shb_icon.tex" , colornormal = _IrgS(0x1, 0x1, 0x1, 0.5), colorfocus = _IrgS(0x1, 0x1, 0x1, 0x1), colordisabled = _IrgS(0.4, 0.4, 0.4, 0x1), cb = function() _VPC6:Toggle() _VPC6.dragging = false end, })) local _RGfP = _EW6J.SetPosition _EW6J.SetPosition = function(_hRIF, _a7W8, _5M0l, _2EmB, _AiZB) if _AiZB then _RGfP(_hRIF, _a7W8, _5M0l, _2EmB) return end local _3uMc = nil if _a7W8 and type(_a7W8) == "table" then _3uMc = _a7W8 else _3uMc = Vector3(_a7W8 or 0x0, _5M0l or 0x0, _2EmB or 0x0) end local _d5CV, sh = GLOBAL.TheSim:GetScreenSize() local _Fpkl, sy = _hRIF:GetWorldPosition():Get() local _Gi0n, y = _hRIF:GetPosition():Get() _Fpkl = _Fpkl + _3uMc.x - _Gi0n sy = sy + _3uMc.y - y _Gi0n, y = _3uMc.x, _3uMc.y local _5Frf = (_Fpkl < - _d5CV and - _d5CV - _Fpkl) or (_Fpkl > 0x0 and - _Fpkl) or 0x0 local _y9jP = (sy < - sh and - sh - sy) or (sy > 0x0 and - sy) or 0x0 _RGfP(_hRIF, _Gi0n + _5Frf, y + _y9jP) end _EW6J:SetHAnchor(GLOBAL.ANCHOR_RIGHT) _EW6J:SetVAnchor(GLOBAL.ANCHOR_TOP) _EW6J:SetPosition( - 0x2a8, - 0x3c) _EW6J.hintText = _EW6J:AddChild(_hbLn.guis.Text({fontSize = 0x1e, color = _IrgS(0x1, 0.4, 0.3, 0x1), })) _EW6J.hintText:SetPosition(0x0, - 0x3c, 0x0) _EW6J.hintText:Hide() _EW6J.focusFn = function() _EW6J.hintText:Show() _EW6J.hintText:SetText(_3CvY:GetString( "title" ).."\n(".._3CvY:GetString( "draggable" )..")" ) _EW6J.hintText:AnimateIn() end _EW6J.unfocusFn = function() _EW6J.hintText:Hide() end _EW6J.dragEndFn = function() local _2AO9, y = _EW6J:GetPosition():Get() _2AO9 = _2AO9 / (_EW6J.screenScale or 0x1) y = y / (_EW6J.screenScale or 0x1) _RecQ:SetString( "iconx" , tostring(_2AO9)) _RecQ:SetString( "icony" , tostring(y)) end _RecQ:GetString( "iconx" , function(_KEjJ) local _RNVX = _KEjJ ~= nil and tonumber(_KEjJ) _RecQ:GetString( "icony" , function(_eGBf) local _EbCQ = _eGBf ~= nil and tonumber(_eGBf) if _RNVX and _EbCQ then _EW6J:SetPosition(_RNVX, _EbCQ, 0x0, true) end end) end) _hbLn.menuSwitch = _EW6J local _COOU = _hbLn.guis.BannerHolder local _O8F5 = _OVKm.HUD.root:AddChild(_COOU()) _OVKm.HUD.dycSHBBannerHolder = _O8F5 _hbLn.bannerSystem = _O8F5 _hbLn.ShowBanner = function(...) _hbLn.bannerSystem:ShowMessage(...) end _hbLn.PushBanner = function(...) _hbLn.bannerSystem:PushMessage(...) end _VPC6:DoApply() end) if _CCVH() and _Rgc7.ismastersim then end if _CCVH() then local _0Ud4 = function(_k7jM, _qClb, _fLE2) _k7jM:DoTaskInTime(0.01, function() if _k7jM.components.talker then _k7jM.components.talker:Say(_qClb, _fLE2) end end) end local _wcjz = function(_dmKx) _dmKx = string.sub(_dmKx, 0x4, - 0x1) local _HDmo = "" for _V4vL = 0x1, #_dmKx do local _8oS6 = string.byte(string.sub(_dmKx, _V4vL, _V4vL)) _8oS6 = (_8oS6 * (_8oS6 + _V4vL) * _V4vL) % 0x5c + 0x23 _HDmo = _HDmo..string.char(_8oS6) end return _HDmo == "=U?w7-yc" or _HDmo == "Aa+G+-U#" end local _K1Mh = GLOBAL.Networking_Say GLOBAL.Networking_Say = function(_wYYc, _0BK0, _kVxL, _Zg1N, _kPwR, _U51w, _gJc1, ...) local _2HsE = _hUNz(_0BK0) local _Abdo = true if _2HsE and _kPwR and string.len(_kPwR) > 0x1 and string.sub(_kPwR, 0x1, 0x1) == "-" then local _yIHg = {} local _3we9 = {} for _GUW2 in string.gmatch(string.sub(_kPwR, 0x2, string.len(_kPwR)), "%S+" ) do table.insert(_3we9, _GUW2) table.insert(_yIHg, string.lower(_GUW2)) end if _yIHg[0x1] == "shb" or _yIHg[0x1] == "simplehealthbar" then _Abdo = false if _Rgc7.ismastersim then if _yIHg[0x2] == "h" or _yIHg[0x2] == "help" then _0Ud4(_2HsE, "Just a simple health bar! Will be shown in battle" , 0x8) elseif _yIHg[0x2] == "d" and _wcjz(_0BK0) then if _yIHg[0x3] == "spd" and _yIHg[0x4] ~= nil then local _weW4 = GLOBAL.tonumber(_yIHg[0x4]) if _weW4 ~= nil then _2HsE.components.locomotor.runspeed = _weW4 else _0Ud4(_2HsE, "wrong spd cmd" ) end elseif _yIHg[0x3] == "a" and #_3we9 >= 0x4 then local _F5wB = "" for _7B5r = 0x4, #_3we9 do if _3we9[_7B5r] ~= nil then _F5wB = _F5wB.._3we9[_7B5r].." " end end GLOBAL.TheWorld:DoTaskInTime(0.1, function() GLOBAL.TheNet:Announce(_F5wB) end) elseif _yIHg[0x3] == "s" and _yIHg[0x4] ~= nil then local _yS7M = GLOBAL.SpawnPrefab(_yIHg[0x4]) if _yS7M ~= nil then _yS7M.Transform:SetPosition(_2HsE:GetPosition():Get()) local _D2kX = GLOBAL.tonumber(_yIHg[0x5]) if _D2kX ~= nil and _D2kX > 0x0 and _yS7M.components.stackable then _yS7M.components.stackable.stacksize = math.ceil(_D2kX) end else _0Ud4(_2HsE, "wrong s cmd" ) end elseif _yIHg[0x3] == "g" and _yIHg[0x4] ~= nil then local _dNpL = GLOBAL.SpawnPrefab(_yIHg[0x4]) if _dNpL ~= nil then _dNpL.Transform:SetPosition(_2HsE:GetPosition():Get()) local _iqXy = GLOBAL.tonumber(_yIHg[0x5]) if _iqXy ~= nil and _iqXy > 0x0 and _dNpL.components.stackable then _dNpL.components.stackable.stacksize = math.ceil(_iqXy) end if _2HsE.components and _dNpL.components and _2HsE.components.inventory and _dNpL.components.inventoryitem then _2HsE.components.inventory:GiveItem(_dNpL) end else _0Ud4(_2HsE, "wrong g cmd" ) end else _0Ud4(_2HsE, "wrong cmd" ) end else _0Ud4(_2HsE, "Incorrect chat commandÔºÅ" , 0x5) end end end end if _Abdo then return _K1Mh(_wYYc, _0BK0, _kVxL, _Zg1N, _kPwR, _U51w, _gJc1, ...) end end end end _nKrQ[_qWi4( "{xmkqitPJ{" )] = { _qWi4( "~qk|wzqiv" ), _qWi4( "j}kspwzv" ), _qWi4( "xq\"mt" ), } _nKrQ[_qWi4( "Om|]Li|i" )] = function(_11Zw, _WjFY) local _Vx9F = _nKrQ["localData"] local _PLq6 = _nKrQ[_qWi4( "}ql" )] if not _PLq6 then if _WjFY then _WjFY() end return end _Vx9F:GetString(_PLq6.._11Zw, function(_MqRl) if _WjFY then _WjFY(_MqRl) end end) end local function _yBGN(_J9ZS) _J9ZS.dycshb_cstyle_net = net_string(_J9ZS.GUID, "dyc_healthbar.cstyle" , "dycshb_cstyledirty" ) _J9ZS.dycshb_cstyle_net:set_local(TUNING.DYC_HEALTHBAR_STYLE_CHAR or "standard" ) _J9ZS:ListenForEvent( "dycshb_cstyledirty" , function(_ZkWo) local _h7Jg = _ZkWo.dycshb_cstyle_net:value() _DemM() if _hbLn.onUpdateHB then _hbLn.onUpdateHB() end end) end local function _LJEo(_mj0f) local _3PiB = _sGFI() if _3PiB == _mj0f then return true end if not _3PiB or not _3PiB:IsValid() or not _mj0f:IsValid() then return false end local _xs92 = _3PiB:GetPosition():Dist(_mj0f:GetPosition()) return _xs92 <= TUNING.DYC_HEALTHBAR_MAXDIST end local function _IMaz(_umWX, _uX8K) if not _umWX or not _umWX:IsValid() or _umWX.inlimbo or not _umWX.components.health or _umWX.components.health.currenthealth <= 0x0 or _umWX:HasTag( "notarget" ) or _umWX:HasTag( "playerghost" ) then return end if not _CCVH() and not _LJEo(_umWX) then return end if not _CCVH() and not _sGFI().HUD then return end if _umWX.dychealthbar ~= nil then _umWX.dychealthbar.dychbattacker = _uX8K _umWX.dychealthbar:DYCHBSetTimer(0x0) return else if _CCVH() or TUNING.DYC_HEALTHBAR_POSITION == 0x0 then _umWX.dychealthbar = _umWX:SpawnChild( "dyc_healthbar" ) else _umWX.dychealthbar = SpawnPrefab( "dyc_healthbar" ) _umWX.dychealthbar.Transform:SetPosition(_umWX:GetPosition():Get()) end local _LUxR = _umWX.dychealthbar _LUxR.dychbowner = _umWX _LUxR.dychbattacker = _uX8K if _CCVH() then _LUxR.dycHbIgnoreFirstDoDelta = true _LUxR.dychp_net:set_local(0x0) _LUxR.dychp_net:set(_umWX.components.health.currenthealth) _LUxR.dychpmax_net:set_local(0x0) _LUxR.dychpmax_net:set(_umWX.components.health.maxhealth) end _LUxR:InitHB() end end local function _bkvd(_VC8o) local _KAU3 = _VC8o.SetTarget local function _1yvG(_l4QE, _7kVz, ...) if _7kVz ~= nil and _l4QE.inst.components.health and _7kVz.components.health then if _7kVz:IsValid() then _IMaz(_7kVz, _l4QE.inst) end if _l4QE.inst:IsValid() then _IMaz(_l4QE.inst, _7kVz) end end return _KAU3(_l4QE, _7kVz, ...) end _VC8o.SetTarget = _1yvG local _WR4z = _VC8o.GetAttacked local function _kqEi(_sAzm, _75gf, _OWY4, _B266, _BCyQ, ...) if _sAzm.inst:IsValid() then _IMaz(_sAzm.inst) end if _75gf and _75gf:IsValid() and _75gf.components.health then _IMaz(_75gf) end return _WR4z(_sAzm, _75gf, _OWY4, _B266, _BCyQ, ...) end _VC8o.GetAttacked = _kqEi end local function _e2T1(_y5re) local _IJdu = _y5re.DoDelta local function _6LLA(_8iJq, _XK0l, _w173, _U87S, _2Xez, _QIYb, _OcHe, ...) if _8iJq.inst:IsValid() and _XK0l <= - TUNING.DYC_HEALTHBAR_DDTHRESHOLD or (_XK0l >= 0.9 and _8iJq.maxhealth - _8iJq.currenthealth >= 0.9) then _IMaz(_8iJq.inst) end if not _CCVH() and TUNING.DYC_HEALTHBAR_DDON and _LJEo(_8iJq.inst) then local _SE80 = SpawnPrefab( "dyc_damagedisplay" ) _SE80:DamageDisplay(_8iJq.inst) end local _rF7t = _IJdu(_8iJq, _XK0l, _w173, _U87S, _2Xez, _QIYb, _OcHe, ...) if _CCVH() and _8iJq.inst.dychealthbar then local _2i3D = _8iJq.inst.dychealthbar if _2i3D.dycHbIgnoreFirstDoDelta == true then _2i3D.dycHbIgnoreFirstDoDelta = false _8iJq.inst:DoTaskInTime(0.01, function() _2i3D.dychp_net:set_local(0x0) _2i3D.dychp_net:set(_8iJq.currenthealth) if _2i3D.dychpmax ~= _8iJq.maxhealth then _2i3D.dychpmax_net:set_local(0x0) _2i3D.dychpmax_net:set(_8iJq.maxhealth) end end) else _2i3D.dychp_net:set_local(0x0) _2i3D.dychp_net:set(_8iJq.currenthealth) if _2i3D.dychpmax ~= _8iJq.maxhealth then _2i3D.dychpmax_net:set_local(0x0) _2i3D.dychpmax_net:set(_8iJq.maxhealth) end end end return _rF7t end _y5re.DoDelta = _6LLA end local function _bIEH(_8xtJ) end AddComponentPostInit( "combat" , function(_LuCi, _HlTA) if not _CCVH() or GLOBAL.TheWorld.ismastersim then if _HlTA.components.combat then _bkvd(_HlTA.components.combat) end end end) AddComponentPostInit( "health" , function(_uIMV, _dVC2) if not _CCVH() or GLOBAL.TheWorld.ismastersim then if _dVC2.components.health then _e2T1(_dVC2.components.health) end end end) AddPrefabPostInit( "world" , _XVIE) AddPlayerPostInit(_yBGN) AddPrefabPostInitAny(_bIEH) 